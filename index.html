<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>ğŸ†˜ Cá»¨U Há»˜ MIá»€N TRUNG</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- MarkerCluster (optional) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script defer src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ğŸ†˜ Cá»¨U Há»˜ MIá»€N TRUNG</h1>
    <div class="header-controls">
      <div id="userBox" class="small">ChÆ°a Ä‘Äƒng nháº­p</div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="btn-sos" class="btn danger">ğŸ“£ SOS</button>
        <button id="btn-open-sos-chat" class="btn ghost">Chat SOS</button>
        <button id="btn-logout" class="btn ghost" style="display:none">ÄÄƒng xuáº¥t</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <aside class="left">
      <section class="panel">
        <strong>ÄÄƒng nháº­p / ÄÄƒng kÃ½</strong>
        <div class="small">DÃ¹ng email Ä‘á»ƒ quáº£n lÃ½ bÃ i Ä‘Äƒng</div>
        <form id="form-auth">
          <input id="auth-email" type="email" placeholder="Email" required />
          <input id="auth-password" type="password" placeholder="Máº­t kháº©u" required />
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="btn-login" class="btn" type="submit">ÄÄƒng nháº­p</button>
            <button id="btn-register" class="btn ghost" type="button">ÄÄƒng kÃ½</button>
          </div>
          <div class="small" style="margin-top:8px">Admin máº·c Ä‘á»‹nh: <b>admin@gmail.com</b></div>
        </form>
      </section>

      <section class="panel">
        <strong>ÄÄƒng cáº£nh bÃ¡o</strong>
        <div class="small">Chá»n Ä‘iá»ƒm trÃªn báº£n Ä‘á»“ hoáº·c dÃ¹ng GPS</div>
        <form id="form-post" style="margin-top:8px">
          <input id="post-title" type="text" placeholder="TiÃªu Ä‘á» (vÃ­ dá»¥: Ngáº­p trÆ°á»›c cá»•ng chá»£ X)" required />
          <textarea id="post-desc" placeholder="MÃ´ táº£, hÆ°á»›ng an toÃ n, liÃªn há»‡"></textarea>
          <div style="display:flex;gap:8px">
            <select id="post-severity">
              <option value="green">Ngáº­p nháº¹</option>
              <option value="yellow">Ngáº­p trung bÃ¬nh</option>
              <option value="red">Ngáº­p náº·ng</option>
            </select>
            <select id="post-type">
              <option value="marker">Cháº¥m Ä‘iá»ƒm</option>
              <option value="area">Khoanh vÃ¹ng</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <input id="post-file" type="file" accept="image/*,video/*" />
            <button id="btn-getloc" type="button" class="btn ghost">Láº¥y vá»‹ trÃ­</button>
            <div id="posDisplay" class="small">Vá»‹ trÃ­: chÆ°a</div>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" type="submit">ÄÄƒng</button>
            <button id="btn-clear" type="button" class="btn ghost">XÃ³a</button>
          </div>
          <div class="small" style="margin-top:8px">Trong cháº¿ Ä‘á»™ <b>Khoanh vÃ¹ng</b>, click 2 láº§n trÃªn báº£n Ä‘á»“ Ä‘á»ƒ táº¡o vÃ¹ng.</div>
        </form>
      </section>

      <section class="panel">
        <strong>Äiá»u khiá»ƒn</strong>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="searchBox" type="text" placeholder="TÃ¬m theo tiÃªu Ä‘á»..." />
          <button id="btn-search" class="btn ghost">TÃ¬m</button>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px;align-items:center" class="legend">
          <div style="display:flex;gap:6px;align-items:center"><div class="dot" style="background:#2ecc71"></div><div class="small">Ngáº­p nháº¹</div></div>
          <div style="display:flex;gap:6px;align-items:center"><div class="dot" style="background:#f1c40f"></div><div class="small">Ngáº­p TB</div></div>
          <div style="display:flex;gap:6px;align-items:center"><div class="dot" style="background:#e74c3c"></div><div class="small">Ngáº­p náº·ng</div></div>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="btn-clear-all" class="btn ghost" title="Chá»‰ Admin">Clear All (Admin)</button>
          <button id="btn-redeploy" class="btn ghost">Táº£i láº¡i</button>
        </div>
      </section>

      <section class="panel small">
        <strong>Ghi chÃº</strong>
        <ul>
          <li>ÄÄƒng nháº­p Ä‘á»ƒ Ä‘Äƒng vÃ  bÃ¬nh luáº­n.</li>
          <li>Admin cÃ³ quyá»n xÃ³a bÃ i vÃ  xem báº£ng SOS.</li>
          <li>SOS lÆ°u vÃ o collection <code>sos</code> Ä‘á»ƒ xá»­ lÃ½ nhanh.</li>
        </ul>
      </section>
    </aside>

    <section class="right">
      <div class="panel map-panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Báº£n Ä‘á»“</strong> <span class="small">(Leaflet + OpenStreetMap)</span></div>
          <div class="small">Chá»n Ä‘iá»ƒm Ä‘á»ƒ Ä‘Ã¡nh dáº¥u / khoanh vÃ¹ng</div>
        </div>
        <div id="map" style="margin-top:10px"></div>
      </div>

      <div class="panel feed">
        <strong>Danh sÃ¡ch cáº£nh bÃ¡o</strong>
        <div id="postsList" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <!-- Modal chi tiáº¿t -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong id="modalTitle">Chi tiáº¿t</strong>
        <div><button id="modal-close" class="btn ghost">ÄÃ³ng</button></div>
      </div>
      <div id="modalBody" style="margin-top:10px"></div>
    </div>
  </div>

  <!-- SOS Chat Popup -->
  <div id="sosChat" class="modal" style="display:none" aria-hidden="true">
    <div class="dialog" style="max-width:420px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Chat SOS (riÃªng tÆ°)</strong>
        <div><button id="close-sos-chat" class="btn ghost">ÄÃ³ng</button></div>
      </div>
      <div id="sosMessages" style="margin-top:8px;max-height:50vh;overflow:auto"></div>
      <form id="sosForm" style="display:flex;gap:8px;margin-top:8px">
        <input id="sosInput" placeholder="Ghi ná»™i dung SOS..." style="flex:1"/>
        <button class="btn" type="submit">Gá»­i</button>
      </form>
    </div>
  </div>

  <!-- App script (module) -->
  <script type="module" src="app.js"></script>

  <!-- Service worker registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js').catch(()=>{ /* ignore */ });
    }
  </script>
</body>
</html>